<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Origin Client - Animated Items Maker</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Arial, sans-serif;
      background: url('file.png') no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(10px);
      color: white;
      min-height: 100vh;
    }
    header {
      text-align: center;
      padding: 1em;
      background: rgba(0, 0, 0, 0.5);
      font-size: 1.5em;
    }
    main {
      padding: 1em;
    }
    select, input[type="text"], input[type="file"] {
      width: 100%;
      margin: 0.5em 0;
      padding: 0.5em;
      background: rgba(0,0,0,0.5);
      border: none;
      color: white;
    }
    button {
      padding: 0.5em 1em;
      background: rgba(255,255,255,0.1);
      color: white;
      border: none;
      border-radius: 8px;
      margin-top: 1em;
      cursor: pointer;
    }
    .dropdown-section {
      background: rgba(0,0,0,0.4);
      border-radius: 0.5em;
      margin-top: 1em;
      overflow: hidden;
    }
    .dropdown-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8em;
      background: rgba(0,0,0,0.6);
      cursor: pointer;
    }
    .dropdown-content {
      display: none;
      padding: 1em;
    }
    .frame-container {
      margin-bottom: 1em;
    }
    .frame-preview {
      display: block;
      max-width: 100px;
      margin-top: 0.5em;
    }
    .remove-img-button {
      display: block;
      background: red;
      margin-top: 0.5em;
      border-radius: 0.3em;
    }
    .delete-button {
      background: rgba(255,0,0,0.5);
      width: 1.5em;
      height: 1.5em;
      border-radius: 0.2em;
      font-size: 1.2em;
      text-align: center;
      line-height: 1.5em;
      color: white;
      border: none;
      cursor: pointer;
    }
    #toast {
      position: fixed;
      bottom: 1em;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 0, 0, 0.8);
      padding: 0.7em 1.5em;
      border-radius: 0.5em;
      display: none;
      color: white;
    }
  </style>
</head>
<body>
  <header>Origin Client - Animated Items Maker</header>
  <main>
    <input type="text" id="packNameInput" placeholder="Enter Pack Name (optional)">
    <label>Upload pack_icon.png</label>
    <input type="file" id="packIconInput" accept="image/png">
    <img id="packIconPreview" style="max-width: 64px; margin-top: 0.5em; display: block;" />

    <label>Add your item</label>
    <select id="itemSelector">
      <option value="none">Select an item</option>
      <option value="diamond_sword">Diamond Sword</option>
      <option value="netherite_sword">Netherite Sword</option>
      <option value="totem_of_undying">Totem of Undying</option>
    </select>

    <div id="dropdownContainer"></div>
    <button id="downloadBtn">Download Pack</button>
    <div id="toast"><span id="toastMsg"></span></div>
  </main>

  <script type="module">
    import JSZip from 'https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm';

    const addedItems = new Set();
    const itemSelector = document.getElementById('itemSelector');
    const container = document.getElementById('dropdownContainer');
    const toast = document.getElementById('toast');
    const toastMsg = document.getElementById('toastMsg');
    const packIconInput = document.getElementById('packIconInput');
    const packIconPreview = document.getElementById('packIconPreview');

    itemSelector.addEventListener('change', () => {
      const item = itemSelector.value;
      if (item === "none" || addedItems.has(item)) return;
      addedItems.add(item);

      const section = document.createElement('div');
      section.className = 'dropdown-section';
      section.setAttribute('data-item', item);

      const header = document.createElement('div');
      header.className = 'dropdown-header';
      header.innerHTML = `<span>${item}</span>`;

      const closeBtn = document.createElement('button');
      closeBtn.className = 'delete-button';
      closeBtn.textContent = 'Ã—';
      closeBtn.onclick = () => {
        addedItems.delete(item);
        section.remove();
      };
      header.appendChild(closeBtn);
      section.appendChild(header);

      const content = document.createElement('div');
      content.className = 'dropdown-content';
      section.appendChild(content);

      if (item === "totem_of_undying") {
        content.innerHTML += `
          <label>Upload right_totem.json</label>
          <input type="file" class="json-upload" data-filename="right_totem.json" accept=".json">
          <label>Upload left_totem.json</label>
          <input type="file" class="json-upload" data-filename="left_totem.json" accept=".json">
        `;
      } else {
        content.innerHTML += `
          <label>Upload ${item}.json</label>
          <input type="file" class="json-upload" data-filename="${item}.json" accept=".json">
        `;
      }

      for (let i = 1; i <= 10; i++) {
        const frame = document.createElement('div');
        frame.className = 'frame-container';
        frame.innerHTML = `
          <label>Frame ${i}</label>
          <input type="file" id="${item}_frame_${i}" accept="image/*">
          <img class="frame-preview" />
          <button class="remove-img-button">Remove Image</button>
        `;
        content.appendChild(frame);
        const input = frame.querySelector('input');
        const img = frame.querySelector('img');
        const btn = frame.querySelector('button');
        input.onchange = () => {
          if (input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => img.src = e.target.result;
            reader.readAsDataURL(input.files[0]);
          }
        };
        btn.onclick = () => {
          input.value = '';
          img.src = '';
        };
      }

      header.onclick = (e) => {
        if (e.target !== closeBtn) {
          content.style.display = content.style.display === 'block' ? 'none' : 'block';
        }
      };
      content.style.display = 'block';
      container.appendChild(section);
      itemSelector.value = "none";
    });

    packIconInput.onchange = () => {
      const file = packIconInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => packIconPreview.src = e.target.result;
        reader.readAsDataURL(file);
      }
    };

    function showToast(msg) {
      toastMsg.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 3000);
    }

    document.getElementById('downloadBtn').onclick = async () => {
      if (addedItems.size === 0) return showToast("error: No items added");

      const zip = new JSZip();
      const packName = document.getElementById('packNameInput').value.trim() || "origin_animated_textures";
      const attachables = zip.folder("attachables");

      if (packIconInput.files[0]) {
        zip.file("pack_icon.png", packIconInput.files[0]);
      }

      for (const item of addedItems) {
        const section = document.querySelector(`.dropdown-section[data-item="${item}"]`);
        const jsonInputs = section.querySelectorAll('.json-upload');

        for (const input of jsonInputs) {
          if (input.files.length === 0) return showToast(`error: Missing JSON file for ${input.dataset.filename}`);
          attachables.file(input.dataset.filename, input.files[0]);
        }

        const short = {
          diamond_sword: 'ds',
          netherite_sword: 'ns',
          totem_of_undying: 't'
        }[item];

        for (let i = 1; i <= 10; i++) {
          const input = document.getElementById(`${item}_frame_${i}`);
          if (!input || !input.files[0]) return showToast(`error: Missing frame ${i} for ${item}`);
          zip.folder(`textures/${item}`).file(`${short}${i}.png`, input.files[0]);
        }
      }

      const blob = await zip.generateAsync({ type: 'blob' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = packName + ".mcpack";
      a.click();
    };
  </script>
</body>
</html>
