<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ORIGIN CLIENT -animated items maker-</title>
  <style>
    @font-face {
      font-family: 'MCTen';
      src: url('mc-ten-lowercase-alt.ttf');
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'MCTen', sans-serif;
      background: url('file.png') no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(8px);
      overflow-x: hidden;
      color: white;
    }

    header {
      position: fixed;
      top: 0;
      width: 100%;
      background-color: black;
      text-align: center;
      padding: 10px;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
    }

    header h2 {
      margin: 0;
      font-size: 16px;
    }

    .container {
      margin-top: 100px;
      padding: 20px;
    }

    .dropdown-section {
      background-color: rgba(0,0,0,0.5);
      padding: 10px;
      margin-top: 10px;
      border-radius: 10px;
      position: relative;
    }

    .dropdown-section h3 {
      margin-top: 0;
    }

    .frame {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .frame input[type="file"] {
      margin-right: 10px;
    }

    .frame img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      border: 1px solid white;
      margin-right: 10px;
    }

    .remove-frame-btn {
      background: red;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      padding: 2px 6px;
    }

    .remove-dropdown {
      position: absolute;
      top: 5px;
      right: 10px;
      cursor: pointer;
      color: red;
      font-size: 20px;
      font-weight: bold;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,0,0,0.9);
      padding: 10px 20px;
      color: white;
      border-radius: 5px;
      display: flex;
      align-items: center;
      z-index: 1000;
    }

    .toast button {
      margin-left: 20px;
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .dialog-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .dialog-box {
      background: white;
      color: black;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    button, select, input {
      font-family: 'MCTen', sans-serif;
    }

    #downloadBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
    }

    #packNameInput, #itemSelect {
      margin-bottom: 10px;
      padding: 5px;
      width: 200px;
    }

    #iconPreview {
      width: 64px;
      height: 64px;
      object-fit: contain;
      border: 1px solid white;
      margin-left: 10px;
    }
  </style>
</head>
<body>

<header>
  <h1>ORIGIN CLIENT</h1>
  <h2>-animated items maker-</h2>
</header>

<div class="container">
  <label style="color:white">Pack name:</label><br>
  <input type="text" id="packNameInput" placeholder="Enter pack name"><br><br>

  <label style="color:white">Pack Icon:</label>
  <input type="file" id="packIconInput" accept="image/*">
  <img id="iconPreview" src="#" class="hidden"><br><br>

  <label style="color:white">Add your item:</label><br>
  <select id="itemSelect">
    <option value="">none</option>
    <option value="diamond_sword">diamond_sword</option>
    <option value="netherite_sword">netherite_sword</option>
    <option value="totem_of_undying">totem_of_undying</option>
    <option value="netherite_axe">netherite_axe</option>
    <option value="diamond_axe">diamond_axe</option>
    <option value="netherite_pickaxe">netherite_pickaxe</option>
    <option value="diamond_pickaxe">diamond_pickaxe</option>
  </select>

  <div id="itemsContainer"></div>

  <button id="downloadBtn">Download</button>
</div>

<div id="toast" class="toast hidden">
  <span id="toastMsg"></span>
  <button onclick="closeToast()">x</button>
</div>

<div id="confirmDialog" class="dialog-overlay hidden">
  <div class="dialog-box">
    <p>Are you sure?</p>
    <button id="confirmYes">Yes</button>
    <button id="confirmNo">No</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jszip"></script>
<script>
  const itemSelect = document.getElementById("itemSelect");
  const itemsContainer = document.getElementById("itemsContainer");
  const packIconInput = document.getElementById("packIconInput");
  const iconPreview = document.getElementById("iconPreview");
  const toast = document.getElementById("toast");
  const toastMsg = document.getElementById("toastMsg");
  const confirmDialog = document.getElementById("confirmDialog");
  let currentPackIcon = null;
  let itemsAdded = {};
  let toDeleteSection = null;

  packIconInput.addEventListener('change', () => {
    const file = packIconInput.files[0];
    if (file) {
      currentPackIcon = file;
      iconPreview.classList.remove("hidden");
      iconPreview.src = URL.createObjectURL(file);
    }
  });

  itemSelect.addEventListener("change", () => {
    const value = itemSelect.value;
    if (!value || itemsAdded[value]) return;

    itemsAdded[value] = true;

    const section = document.createElement("div");
    section.className = "dropdown-section";
    section.dataset.itemType = value;

    const closeBtn = document.createElement("span");
    closeBtn.className = "remove-dropdown";
    closeBtn.textContent = "Ã—";
    closeBtn.onclick = () => {
      toDeleteSection = section;
      confirmDialog.classList.remove("hidden");
    };

    const title = document.createElement("h3");
    title.textContent = `Item name: ${value}`;

    section.appendChild(closeBtn);
    section.appendChild(title);

    for (let i = 1; i <= 10; i++) {
      const frame = document.createElement("div");
      frame.className = "frame";
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";
      input.className = "frame-input";

      const img = document.createElement("img");
      img.className = "preview hidden";

      input.addEventListener("change", () => {
        if (input.files[0]) {
          img.src = URL.createObjectURL(input.files[0]);
          img.classList.remove("hidden");
        } else {
          img.classList.add("hidden");
        }
      });

      const remove = document.createElement("button");
      remove.textContent = "X";
      remove.className = "remove-frame-btn";
      remove.onclick = () => {
        input.value = '';
        img.classList.add("hidden");
      };

      frame.append(`Add frame ${i}:`, input, img, remove);
      section.appendChild(frame);
    }

    itemsContainer.appendChild(section);
    itemSelect.value = "";
  });

  document.getElementById("confirmYes").onclick = () => {
    if (toDeleteSection) {
      const itemType = toDeleteSection.dataset.itemType;
      delete itemsAdded[itemType];
      toDeleteSection.remove();
      toDeleteSection = null;
    }
    confirmDialog.classList.add("hidden");
  };

  document.getElementById("confirmNo").onclick = () => {
    toDeleteSection = null;
    confirmDialog.classList.add("hidden");
  };

  function closeToast() {
    toast.classList.add("hidden");
  }

  document.getElementById("downloadBtn").addEventListener("click", async () => {
    const zip = new JSZip();
    const items = document.querySelectorAll(".dropdown-section");
    const packName = document.getElementById("packNameInput").value || "origin_animated_textures";

    if (items.length === 0) {
      toastMsg.textContent = "error:file_empty";
      toast.classList.remove("hidden");
      return;
    }

    const attachables = zip.folder("attachables");
    const promises = [];

    items.forEach(section => {
      const itemType = section.dataset.itemType;
      const prefixMap = {
        diamond_sword: "ds",
        netherite_sword: "ns",
        totem_of_undying: "t",
        diamond_axe: "da",
        netherite_axe: "na",
        diamond_pickaxe: "dp",
        netherite_pickaxe: "np"
      };
      const prefix = prefixMap[itemType] || itemType[0];
      const frameFolder = zip.folder(`textures/${itemType}`);
      const frames = section.querySelectorAll(".frame-input");
      let missing = false;

      frames.forEach((input, index) => {
        const file = input.files[0];
        if (file) {
          frameFolder.file(`${prefix}${index + 1}.png`, file);
        } else {
          missing = true;
          toastMsg.textContent = `error:${itemType}:frame_${index + 1} texture not available`;
          toast.classList.remove("hidden");
        }
      });

      if (!missing) {
        // Fetch the attachable JSON
        promises.push(fetch(`${itemType}.json`).then(res => res.text()).then(text => {
          attachables.file(`${itemType}.json`, text);
        }));
      }
    });

    Promise.all(promises).then(() => {
      if (currentPackIcon) {
        zip.file("pack_icon.png", currentPackIcon);
      }

      zip.file("manifest.json", JSON.stringify({
        format_version: 2,
        header: {
          description: packName,
          name: packName,
          uuid: generateUUID(),
          version: [1, 0, 0]
        },
        modules: []
      }, null, 2));

      zip.generateAsync({ type: "blob" }).then(content => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(content);
        a.download = `${packName}.mcpack`;
        a.click();
      });
    });
  });

  function generateUUID() {
    return ([1e7]+-1e3+-4e3+-8e3+-1e11)
      .replace(/[018]/g, c =>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );
  }
</script>

</body>
</html>
