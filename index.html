<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Origin Client - Animated Items Maker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      background: url('file.png') no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(10px);
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
    }
    header {
      text-align: center;
      padding: 1em;
      background: rgba(0, 0, 0, 0.5);
      font-size: 1.5em;
    }
    main {
      padding: 1em;
    }
    select, input[type="text"] {
      margin: 0.5em 0;
      padding: 0.5em;
      background: rgba(0,0,0,0.5);
      border: none;
      color: white;
      width: 100%;
    }
    button {
      padding: 0.5em 1em;
      margin-top: 1em;
      background: rgba(255,255,255,0.1);
      color: white;
      border: none;
      border-radius: 0.5em;
      cursor: pointer;
    }
    .dropdown-section {
      border: 1px solid rgba(255,255,255,0.1);
      margin-top: 1em;
      background: rgba(0,0,0,0.4);
      border-radius: 0.5em;
    }
    .dropdown-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.7em 1em;
      cursor: pointer;
      background: rgba(0,0,0,0.6);
    }
    .dropdown-title {
      font-weight: bold;
    }
    .dropdown-content {
      padding: 1em;
      display: none;
    }
    .frame-container {
      margin-bottom: 1em;
    }
    .frame-preview {
      display: block;
      max-width: 100px;
      margin-top: 0.5em;
    }
    .remove-img-button {
      display: block;
      margin-top: 0.5em;
      background: red;
      border-radius: 0.3em;
    }
    .delete-button {
      background: rgba(255,0,0,0.5);
      color: white;
      font-size: 1.2em;
      width: 1.5em;
      height: 1.5em;
      line-height: 1.5em;
      text-align: center;
      border: none;
      border-radius: 0.2em;
      cursor: pointer;
    }
    #toast {
      position: fixed;
      bottom: 1em;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 0, 0, 0.8);
      padding: 0.7em 1.5em;
      border-radius: 0.5em;
      display: none;
      color: white;
      font-weight: bold;
    }
    #packIconPreview {
      max-width: 64px;
      margin-top: 0.5em;
      display: block;
    }
  </style>
</head>
<body>
  <header>Origin Client - Animated Items Maker</header>
  <main>
    <input type="text" id="packNameInput" placeholder="Enter Pack Name (optional)">
    <label for="packIconInput">Upload pack_icon.png</label>
    <input type="file" id="packIconInput" accept="image/png">
    <img id="packIconPreview" />

    <label for="itemSelector">Add your item</label>
    <select id="itemSelector">
      <option value="none">Select an item</option>
      <option value="diamond_sword">Diamond Sword</option>
      <option value="netherite_sword">Netherite Sword</option>
      <option value="totem_of_undying">Totem of Undying</option>
      <option value="netherite_axe">Netherite Axe</option>
      <option value="diamond_axe">Diamond Axe</option>
      <option value="netherite_pickaxe">Netherite Pickaxe</option>
      <option value="diamond_pickaxe">Diamond Pickaxe</option>
      <option value="apple">Apple</option>
      <option value="apple_golden">Golden Apple</option>
    </select>

    <div id="dropdownContainer"></div>
    <button id="downloadBtn">Download Pack</button>
    <div id="toast"><span id="toastMsg"></span></div>
  </main>

  <script>
    const addedItems = new Set();
    const itemSelector = document.getElementById('itemSelector');
    const container = document.getElementById('dropdownContainer');
    const toast = document.getElementById('toast');
    const toastMsg = document.getElementById('toastMsg');
    const packIconInput = document.getElementById('packIconInput');
    const packIconPreview = document.getElementById('packIconPreview');

    itemSelector.addEventListener('change', () => {
      const item = itemSelector.value;
      if (item === "none" || addedItems.has(item)) return;
      addedItems.add(item);

      const section = document.createElement('div');
      section.className = 'dropdown-section';
      section.setAttribute('data-item', item);

      const header = document.createElement('div');
      header.className = 'dropdown-header';

      const title = document.createElement('div');
      title.className = 'dropdown-title';
      title.textContent = item;

      const closeBtn = document.createElement('button');
      closeBtn.className = 'delete-button';
      closeBtn.textContent = 'Ã—';
      closeBtn.onclick = () => {
        addedItems.delete(item);
        section.remove();
      };

      header.appendChild(title);
      header.appendChild(closeBtn);
      section.appendChild(header);

      const content = document.createElement('div');
      content.className = 'dropdown-content';

      for (let i = 1; i <= 10; i++) {
        const frame = document.createElement('div');
        frame.className = 'frame-container';

        const label = document.createElement('label');
        label.textContent = `Frame ${i}`;

        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.id = `${item}_frame_${i}`;

        const img = document.createElement('img');
        img.className = 'frame-preview';

        input.onchange = () => {
          const file = input.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = e => img.src = e.target.result;
            reader.readAsDataURL(file);
          }
        };

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-img-button';
        removeBtn.textContent = 'Remove Image';
        removeBtn.onclick = () => {
          input.value = '';
          img.src = '';
        };

        frame.appendChild(label);
        frame.appendChild(input);
        frame.appendChild(img);
        frame.appendChild(removeBtn);
        content.appendChild(frame);
      }

      section.appendChild(content);
      container.appendChild(section);
      itemSelector.value = "none";

      header.addEventListener('click', (e) => {
        if (e.target !== closeBtn) {
          const isVisible = content.style.display !== 'none';
          content.style.display = isVisible ? 'none' : 'block';
        }
      });

      content.style.display = 'block';
    });

    packIconInput.onchange = () => {
      const file = packIconInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => packIconPreview.src = e.target.result;
        reader.readAsDataURL(file);
      }
    };

    function showToast(msg) {
      toastMsg.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 3000);
    }

    document.getElementById('downloadBtn').onclick = async () => {
      if (addedItems.size === 0) return showToast("error:file_empty");

      const JSZip = await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm');
      const zip = new JSZip.default();
      const packName = document.getElementById('packNameInput').value.trim() || "origin_animated_textures";

      if (packIconInput.files[0]) {
        zip.file('pack_icon.png', packIconInput.files[0]);
      }

      const attachablesFolder = zip.folder('attachables');
      const jsonFiles = {
        diamond_sword: 'diamond_sword.json',
        netherite_sword: 'netherite_sword.json',
        netherite_axe: 'netherite_axe.json',
        diamond_axe: 'diamond_axe.json',
        netherite_pickaxe: 'netherite_pickaxe.json',
        diamond_pickaxe: 'diamond_pickaxe.json',
        apple: 'apple.json',
        apple_golden: 'apple_golden.json'
      };

      for (const item of addedItems) {
        const short = {
          diamond_sword: 'ds',
          netherite_sword: 'ns',
          totem_of_undying: 't',
          netherite_axe: 'na',
          diamond_axe: 'da',
          netherite_pickaxe: 'np',
          diamond_pickaxe: 'dp',
          apple: 'a',
          apple_golden: 'ag'
        }[item];

        if (item === "totem_of_undying") {
          attachablesFolder.file("right_totem.json", `{"item": "${item}"}`);
          attachablesFolder.file("left_totem.json", `{"item": "${item}"}`);
        } else {
          attachablesFolder.file(jsonFiles[item], `{"item": "${item}"}`);
        }

        for (let i = 1; i <= 10; i++) {
          const input = document.getElementById(`${item}_frame_${i}`);
          if (input && input.files.length > 0) {
            zip.folder(`textures/${item}`).file(`${short}${i}.png`, input.files[0]);
          } else {
            return showToast(`error:${item}:frame_${i} texture not available`);
          }
        }
      }

      const blob = await zip.generateAsync({ type: 'blob' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = packName + ".mcpack";
      a.click();
    };
  </script>
</body>
</html>
